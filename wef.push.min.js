/**
 * wef.push.min.js
 * WEF Push library
 * @since 2013. 05. 22.
 * @version 0.1
 * @author sjune@wiseeco.com
 * @last_modified
 */
var WEF=WEF||{};
WEF.Push=function(){var l={},m=null,g=null,c=null,h=!1,n=!1,q=null,r=null,d=function(a){return"undefined"!==typeof a},k=function(){h=!1;null!==c&&c.abort();l={}},p=function(){var a,e,b=0,d=0,f;c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){clearTimeout(q);if(null!==m){e=c.responseText.split(/\r\n/);for(a=0;a<e.length;a++)try{for(b in f=JSON.parse(e[a]),f)for(d in f[b])null!=m&&m(d,f[b][d])}catch(l){k(),null!=g&&g("bad JSON response.")}}h&&(r=setTimeout(function(){p()},
500))}else!n&&h&&(k(),null!=g&&g(c.statusText,c.responseText))};q=setTimeout(function(){n=!0;c.abort();clearTimeout(r);n=!1;h&&setTimeout(function(){p()},500)},1E4);c.open("POST","http://www.wiseeco.com:1884/stream",!0);c.send(JSON.stringify(l))};k();return{stream:function(){h=!1;null!==c&&c.abort();h=!0;p()},subscribe:function(a,e){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==b.readyState)if(200==b.status){var a=JSON.parse(b.responseText);l[a.id]=a.seckey;d(e)&&d(e.success)&&e.success()}else d(e)&&
d(e.error)&&e.error(b.statusText,b.responseText),k(),null!=g&&g()};b.open("POST","http://www.wiseeco.com:1884/subscribe",!0);b.send(JSON.stringify([a]))},publish:function(a,e,b){var c={};c[a]="string"===typeof e?e:JSON.stringify(e);var f=new XMLHttpRequest;f.onreadystatechange=function(){4==f.readyState&&(200==f.status?d(b)&&d(b.success)&&b.success(a,e):(d(b)&&d(b.error)&&b.error(textStatus,errorThrown),k(),null!=g&&g()))};f.open("POST","http://www.wiseeco.com:1884/publish",!0);f.send(JSON.stringify(c))},
register:function(a){d(a)&&("function"===typeof a.ready&&a.ready(),d(a.data)&&(m=a.data),d(a.error)&&(g=a.error))}}}();
